<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>臭美管理后台</title>
        <link rel="stylesheet" href="../../awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="../../css/reset.css" />
        <link rel="stylesheet" href="../../css/global.css" />
        <link rel="stylesheet" href="../../css/admin.css" />    
        <link rel="stylesheet" href="shop.css" />    
    </head>

    <body>
        <div class="breadcrumb">
            <a class="link" href="ui.html">一级导航</a>
            <span>&gt;</span>
            <a class="link" href="ui.html">二级导航</a>
            <span>&gt;</span>新增店铺
        </div>

        <div class="wrapper">
            <form novalidate="" class="form-vertical" data-role="form">
                <div class="control-group">
                    <label class="control-label" for="">*店铺编号：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*店铺名称：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*所属商户：</label>
                    <div class="control">
                        <input type="text" disabled>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*店铺地址：</label>
                    <select id="province" class="select min-width">
                        <option value="">省份</option>
                        <option value="1">广东</option>
                    </select>
                    <select id="city" class="select min-width">
                        <option value="">城市</option>
                        <option value="1">深圳</option>
                    </select>
                    <select id="area" class="select min-width">
                        <option value="">地区</option>
                        <option value="1">南山</option>
                    </select><br>
                    <textarea class="textarea" id="address" placeholder="详细街道信息"></textarea>
                    <div class="textarea-bar">
                        <span class="area-coor">地理坐标：</span>
                        <span id="coorMarker">未标记</span>
                        <button class="btn area-btn" id="addCoordinate">
                            <i class="fa fa-map-marker"></i> 
                            <span>添加坐标</span>
                        </button>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*所属商圈：</label>
                    <input type="radio" name="area" class="label">
                    <label for="area1">南山区</label>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*店铺类型：</label>
                    <input type="radio" name="sex" class="radio" id="radio1">
                    <label for="radio1">预付款店</label>
                    <input type="radio" name="sex" class="radio" id="radio2">
                    <label for="radio2">投资店</label>
                    <input type="radio" name="sex" class="radio" id="radio3">
                    <label for="radio3">金字塔店</label>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*合同日期：</label>
                    <select class="select min-width">
                        <option value="1">深圳</option>
                    </select>

                    <select class="select min-width">
                        <option value="1">深圳</option>
                    </select>

                    <select class="select min-width">
                        <option value="1">深圳</option>
                    </select>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*合同限期：</label>
                    <select class="select min-width">
                        <option value="1">深圳</option>
                    </select>

                    <select class="select min-width">
                        <option value="1">深圳</option>
                    </select>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*合同编号：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div> 

                <div class="control-group">
                    <label class="control-label" for="">*联系人：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*联系电话：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*店铺电话：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*法人代表：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*法人电话：</label>
                    <div class="control">
                        <input type="text">
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="">*业务代表：</label>
                    <select class="select" style="width:20%;min-width:250px">
                        <option value="1">深圳</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""></label>
                    <button class="btn" style="margin-right:20px">预览</button>
                    <a href="bank.html">
                        <button class="btn-primary">下一步</button>
                    </a>
                </div>                                                                                         
            </form>       
        </div>

        <div id="pop-wrapper" class="hide">
            <div class="mask"></div>
            <div class="pop">
                <div class="pop-header-wrapper">
                    <span class="pop-tip">标记地理坐标</span>
                    <span class="pop-close">×</span>
                </div>
                <div class="pop-search-wrapper">
                    <input  type="text" id="map-search" placeholder="请输入关键字" />
                </div>
                <div class="pop-map-wrapper" id="map-wrapper"></div>
                <div class="pop-bar-wrapper">
                    <div class="bar-mark">
                        <strong>标记位置：</strong>
                        <span id="pop-geo-coor">未标注</span>
                    </div>
                    <div class="bar-group">
                        <button class="btn" id="pop-cancel-btn">取消</button>
                        <button class="btn-primary" id="pop-sure-btn">确定</button>
                    </div>
                </div>                                
            </div>        
        </div>

        <script src="../../js/cfg.js"></script>
        <script src="../../js/jquery.min.js"></script>
        <script src="../../js/sea.js"></script>
        <script src="../../js/ejs.js"></script>
        <script src="../../js/lib.js"></script>
        <script src="../../js/iscroll.js"></script>
        <script src="../../js/admin.js"></script>
        <script src="../../js/frame.js"></script>
        <script src="http://api.map.baidu.com/api?v=2.0&ak=F360d7e9ea3c3ecb5b9b9f2b530be8f4&callback=renderMap()"></script>

        <script>
            $("#addCoordinate").on('click',function(){
                $("#pop-wrapper").show();
            })

            $(".pop-close").on('click',function(){
                $("#pop-wrapper").hide();
            });

            function renderMap (){
                $("#addCoordinate").on('click',function(){
                    var address = $("#address");
                    var geoCoor = $("#pop-geo-coor");
                    address.val() && geoCoor.text(address.val());
                    var addrPonit = {};
                    //在指定的容器内创建地图实例  
                    var map = new BMap.Map("map-wrapper");
                    //默认经纬度point
                    var point = new BMap.Point("113.941893","22.535644");
                    //初始化地图位置（未进行初始化的地图将不能进行任何操作）
                    map.centerAndZoom(point,11);
                    //将平移缩放控件添加到地图上
                    map.addControl(new BMap.NavigationControl());
                    //启用滚轮放大缩小功能
                    map.enableScrollWheelZoom(true);
                    //此处是一个补丁，由于未知的原因直接new Marker对象添加的标注
                    //标注的图标很小，所以这里直接用自己的图标
                    var markerIcon = new BMap.Icon("../../images/marker.png", new BMap.Size(39,25),{
                        anchor : new BMap.Size(10,25) 
                    });
                    //根据point获取address实例
                    var geocoder = new BMap.Geocoder();

                    function drawMarker(point){
                        var marker = new BMap.Marker(point,{icon:markerIcon}); 
                        map.addOverlay(marker);
                        marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画  
                        //map.panTo(point);                                                
                    }

                    if(address.attr('lng') && address.attr('lat')){
                        point = new BMap.Point(address.attr('lng'),address.attr('lat'));
                        drawMarker(point);
                        geocoder.getLocation(point, function(addr) {
                            addrPonit['coor'] = {lng:point.lng,lat:point.lat};
                            geoCoor.attr({"lat": point.lat,"lng": point.lng});
                        });                        
                    }else{
                        var addr = "";
                        var prov = $("#province option:selected");
                        var city = $("#city option:selected");
                        var area = $("#area option:selected");
                        if(prov.val()) addr = addr + prov.text()+"省";
                        if(city.val()) addr = addr + city.text()+"市";
                        if(area.val()) addr = addr + area.text()+"区";
                        addr = addr + address.val();
                        if(addr){
                            geocoder.getPoint(addr, function(p) {
                                point = p ? p : point;
                                drawMarker(point);                       
                            })                                                                            
                        }else{
                            drawMarker(point);                             
                        }
                    }

                    //点击地图选择地理位置
                    map.addEventListener("click", function(event) {
                        point = event.point;
                        map.clearOverlays();
                        drawMarker(point); 
                        geocoder.getLocation(point, function(addr) {
                            addrPonit['coor'] = {lng:point.lng,lat:point.lat};
                            geoCoor.attr({"lat": point.lat,"lng": point.lng});
                            geoCoor.text(addr.address);
                        });
                    });

                    //建立一个自动完成的查询对象
                    var search = new BMap.Autocomplete({"input": "map-search","location": map});
                    search.addEventListener("onconfirm", function(event) {
                        var area = event.item.value;
                        var addr = area.province+area.city+area.district+area.street+area.business;
                        geocoder.getPoint(addr, function(point) {
                            if (point) {
                                map.centerAndZoom(point, 16);
                                map.clearOverlays();
                                drawMarker(point);
                            } else {
                                lib.popup.alert({text:'暂时无法获取您的位置'})
                            }
                        })
                    });

                    $("#pop-cancel-btn").off("click");

                    $("#pop-cancel-btn").on('click',function(){
                        $("#pop-wrapper").hide();
                    });

                    $("#pop-sure-btn").off("click");
                    
                    $("#pop-sure-btn").on('click',function(){
                        if(addrPonit.coor){
                           address.attr('lng',addrPonit.coor.lng);
                           address.attr('lat',addrPonit.coor.lat);
                           $("#coorMarker").text("已标记");
                           $("#pop-wrapper").hide();
                        }else{
                           lib.popup.alert({text:'未标记地图'});
                        }
                    });
                });
            }
        </script>          
    </body>
</html>