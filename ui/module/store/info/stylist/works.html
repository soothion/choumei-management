<!DOCTYPE html>
<html lang="zh-CN">
  <head>
      <meta charset="utf-8">
      <title>臭美管理后台</title>
      <script type="text/javascript" src="/js/include.js"></script>
      <style>
      .pictrue{
          border:1px solid rgba(0,0,0,0.05);
          padding-left:15px;
      }
      .designer-link{
          display: inline-block;
          font-size: 30px;
          margin-left: 20px;
          cursor: pointer;
      }
      .header{
          border-top:1px solid rgba(0,0,0,0.05);
          height: 50px;
          line-height: 50px;
          position: relative;      
      }
      .del{
          position: absolute;
          right: 10px;
          top: 10px;
      }

      .add{
         width:160px!important;
         height:120px!important;
      }

      .border-line{
        border-bottom:1px dashed #ddd;
        margin:10px 0 10px 0;        
      }
      </style>
  </head>
  <body>
        <div class="breadcrumb">
            <a>店铺管理</a>
            <span>&gt;</span>
            <a href="../index.html">店铺资料</a>
            <span>&gt;</span>
            <a href="index.html">造型师列表</a>
            <span>&gt;</span>
            <a href="works.html">个人作品</a>
            <div class="flex-box">
                <div class="flex-item">
                    <h4>个人作品</h4>
                </div>
            </div>
        </div>

        <div class="wrapper">
            <div class="detail-operation">
                <button id="add_works_btn" class="btn-primary">+新增</button>
            </div> 

            <div id="works-wrapper" ajat="Works/index/<%=query.id%>#domid=works-wrapper&tempid=works-t">
                <script type="text/template" id="works-t">
                <div style="width:70%;float:left;">
                    <div class="pictrue">
                        <%data.works && data.works.forEach(function(item,i){%>
                            <div class="header">
                                <span>2015-09-25 11:23:58</span>
                                <span><%=item.description%></span>
                                <i class="fa fa-trash-o fa-3x del"></i>
                            </div>
                            <%if(item.thumbImg && item.commoditiesImg){%>
                                <div class="control-thumbnails" id="control-thumbnails1" data-id="<%=item.recId%>">
                                    <div class="control-thumbnails-item add 1">                                
                                        <img src="<%=item.thumbImg%>" img="<%=item.commoditiesImg%>">
                                        <a class="fa fa-times-circle control-thumbnails-remove" data-id="<%=item.recId%>"></a>
                                        <div class="control-thumbnails-operation flex-box">
                                            <span class="control-thumbnails-before flex-item">
                                                <i class="fa fa-long-arrow-left"></i>
                                            </span>
                                            <span class="control-thumbnails-edit flex-item">
                                                <i class="fa fa-pencil-square-o"></i>
                                            </span>
                                            <span class="control-thumbnails-after flex-item">
                                                <i class="fa fa-long-arrow-right"></i>
                                            </span>
                                        </div>
                                    </div>                          
                                </div>                                 
                            <%}%>

                            <%
                            if(item.img){ 
                                var imgArr = JSON.parse(item.img);
                                imgArr.forEach(function(obj,i){                                
                            %>
                                <div class="control-thumbnails" id="control-thumbnails1" data-id="<%=item.recId%>">
                                    <div class="control-thumbnails-item add">                                
                                        <img src="<%=obj.thumbimg%>" img="<%=obj.img%>">
                                        <a class="fa fa-times-circle control-thumbnails-remove" data-id="<%=obj.recId%>"></a>
                                        <div class="control-thumbnails-operation flex-box">
                                            <span class="control-thumbnails-before flex-item">
                                                <i class="fa fa-long-arrow-left"></i>
                                            </span>
                                            <span class="control-thumbnails-edit flex-item">
                                                <i class="fa fa-pencil-square-o"></i>
                                            </span>
                                            <span class="control-thumbnails-after flex-item">
                                                <i class="fa fa-long-arrow-right"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="control-thumbnails-item add">                                
                                        <img src="<%=obj.thumbimg%>" img="<%=obj.img%>">
                                        <a class="fa fa-times-circle control-thumbnails-remove" data-id="<%=obj.recId%>"></a>
                                        <div class="control-thumbnails-operation flex-box">
                                            <span class="control-thumbnails-before flex-item">
                                                <i class="fa fa-long-arrow-left"></i>
                                            </span>
                                            <span class="control-thumbnails-edit flex-item">
                                                <i class="fa fa-pencil-square-o"></i>
                                            </span>
                                            <span class="control-thumbnails-after flex-item">
                                                <i class="fa fa-long-arrow-right"></i>
                                            </span>
                                        </div>
                                    </div>                                                                                
                                </div>                                 
                            <%})}%>                            
                        <%})%>
                    </div>                                                                                    
                </div>

                <div style="float:left;width:25%;margin:-8px 0px 0px 30px">
                    <%
                    var gradeText={ "1":"资深发型师","2":"资深发型师","1,2":"资深发型师","3":"设计总监", "4":"美发大师"};
                    var fastGradeText={"1":"普通快剪", "2":"总监快剪"};                                   
                    data.salon && data.salon.forEach(function(item,i){
                    %>
                    <div  class="clearfix" >
                        <%if(i==0){%>
                            <h2 class="border-line"><%=item.salonname%></h2>
                        <%}else{%>
                            <h3  class="border-line">店内其他造型师</h3>                           
                        <%}%>
                        <div style="float:left;">
                            <img src="/images/logo.png" style="width:100px;height:100px"/>
                        </div>
                        <div style="float:left;margin-left:10px">
                            <div style="height:33px;vertical-align: middle;line-height: 33px;">
                                <%=item.stylistName%>，<%=item.mobilephone%>
                            </div>
                            <div style="height:33px;vertical-align: middle;line-height: 33px;">
                                <%=gradeText[item.grade]%>，<%=fastGradeText[item.fastGrade]%>
                            </div>
                            <div style="height:33px;vertical-align: middle;line-height: 33px;">
                            <%if(i==0){%>
                                 作品数：<%=item.num%>，上传次数：<%=item.uploadNum%>
                            <%}else{%>
                                 作品数：<%=item.num%>，上传次数：<%=item.uploadNum%> <a class="designer-link">&gt;</a>
                            <%}%>
                            </div>
                        </div>                         
                    </div>
                    <%})%>                                                  
                </div>
                </script>
            </div> 

            <div id="box" style="display:none;">
                <form class="form-vertical">
                    <div class="pictrue" style="padding-top:15px">                  
                        <div class="control-thumbnails" id="control-thumbnails1" data-max="10">
                            <div class="control-thumbnails-item add">                                
                                <img src="http://img01.choumei.cn/1/7/2015101015311444462281264724511.jpg?imageMogr2/crop/!250x294a94a666/thumbnail/420x492">                                     
                                <a class="fa fa-times-circle control-thumbnails-remove"></a>
                                <div class="control-thumbnails-operation flex-box">
                                    <span class="control-thumbnails-before flex-item"><i class="fa fa-long-arrow-left"></i></span>
                                    <span class="control-thumbnails-edit flex-item"><i class="fa fa-pencil-square-o"></i></span>
                                    <span class="control-thumbnails-after flex-item"><i class="fa fa-long-arrow-right"></i></span>
                                </div>
                            </div>

                            <div class="control-thumbnails-item add">                                
                                <img src="http://img01.choumei.cn/1/7/2015101015311444462281264724511.jpg?imageMogr2/crop/!250x294a94a666/thumbnail/420x492">                                     
                                <a class="fa fa-times-circle control-thumbnails-remove"></a>
                                <div class="control-thumbnails-operation flex-box">
                                    <span class="control-thumbnails-before flex-item"><i class="fa fa-long-arrow-left"></i></span>
                                    <span class="control-thumbnails-edit flex-item"><i class="fa fa-pencil-square-o"></i></span>
                                    <span class="control-thumbnails-after flex-item"><i class="fa fa-long-arrow-right"></i></span>
                                </div>
                            </div>                              

                            <div class="control-image-upload" style="width:160px;height:120px;line-height:120px">
                                <div id="imageUpload1">
                                    <i class="fa fa-image"></i>
                                    <em>上传个人作品</em>
                                </div>
                            </div>
                        </div>                                     
                    </div>
                    <div class="control" style="width:100%;display:block;margin:30px 0">
                        <div class="keypress" style="width:inherit;">
                            <textarea maxlength="140" style="width:inherit" data-helpid="textarea-help" required></textarea>
                        </div>
                        <div class="control-help" style="display:none;" id="textarea-help1"></div>
                    </div>
                    <div>
                        <div style="width:33%;margin:20px 33%;" >                    
                            <button class="btn-primary" style="margin-right:20px">提交</button>
                            <button id="cancelBtn" class="btn" type="button">取消</button>
                        </div>                                          
                    </div>
                </form>              
            </div>            
        </div>

        <script type="text/javascript">
            (function(){
               $("#works-wrapper").on("click",".control-thumbnails-remove",function(){
                    var self = this;
                    parent.lib.popup.confirm({
                        text:"正在删除此图片，是否继续?",
                        define:function(){
                            var id  = $(self).data("id");  
                            var sib = $(self).parent().siblings();
                            var str = "";
                            var arr = []; 
                            sib.each(function(i,item){
                                var obj = {
                                    "thumbimg" : $(item).find("img").attr("src"),
                                    "img"      : $(item).find("img").attr("img")
                                };
                                arr.push(obj);                        
                            })
                            if(arr.length > 0){
                                str = JSON.parse(arr);
                            }          
                            lib.ajax({
                                type: "post",
                                url : "Works/del/"+id,
                                data: {img : str}    
                            }).done(function(data, status, xhr){
                                if(data.result == 1){
                                    parent.lib.popup.result({
                                        text:"操作成功！",
                                        define:function(){
                                             $(window).trigger('hashchange');    
                                        }
                                    });                
                                }
                               
                            });
                        }
                    });                                       
               });

               $("#works-wrapper").on("click",".del",function(){ 
                    var self = this;
                    parent.lib.popup.confirm({
                        text:"正在删除作品，是否继续?",
                        define:function(){
                            var id = $(self).parent().next().data("id");
                            debugger;
                            lib.ajax({
                                type: "post",
                                url : "Works/del_list/"+id 
                            }).done(function(data, status, xhr){
                                if(data.result == 1){
                                    parent.lib.popup.result({
                                        text:"操作成功！",
                                        define:function(){
                                            $(window).trigger('hashchange');    
                                        }
                                    });                
                                }
                               
                            }); 
                        }
                    });                                       
                });

                $("#works-wrapper").on("click",".control-thumbnails-edit",function(){   
              
               });

            
                $("#add_works_btn").on('click',function(){
                    lib.popup.box({
                       width:$(window).width(),
                       height:$(window).height(),
                       title:'<h1>新增作品</h1>',
                       content:$("#box").css("display","").html(),
                       complete : function(){
                        $('.popup #cancelBtn').on('click',function(){
                            var popup = $('.popup,.popup-overlay');
                            popup.fadeOut(200, function(){
                                popup.remove();
                            });
                        })
                       }                  
                    });
                    $("#box").css("display","none");
                });


            })()
        </script>

  </body>
</html>