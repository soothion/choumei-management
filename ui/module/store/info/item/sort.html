<!DOCTYPE html>
<html lang="zh-CN">
  <head>
      <meta charset="utf-8">
	  <title>臭美管理后台</title>
	  <script type="text/javascript" src="/js/include.js"></script>
  </head>
  <body>
		<div class="breadcrumb">
			<a>店铺管理 </a><span>&gt;</span><a href="../index.html">店铺资料</a><span>&gt;</span><a href="index.html#p=<%=query.p%>&salonid=<%=query.salonid%>&salonname=<%=query.salonname%>">项目列表</a><span>&gt;</span><a href="sort.html">项目排序</a>
			<div class="flex-box">
				<div class="flex-item">
					<h4>项目排序</h4>
				</div>
				<div>
					<a href="#sort_key=sort_in_type&sort_type=DESC" data-role="hash" class="btn">降序 <i class="fa fa-caret-down"></i></a>
					<a href="#sort_key=sort_in_type&sort_type=ASC" data-role="hash" class="btn">升序 <i class="fa fa-caret-up"></i></a>
				</div>
			</div>
		</div>
		<div class="wrapper">
			<div class="position-group">
				<form data-role="hash">
					<select name="typeid" ajat-one="true" ajat="item/type#domid=type&tempid=type-t" style="min-width:300px" id="type">
						<script type="text/template" id="type-t">
							<%data.forEach(function(item){%>
								<option <%=query.typeid==item.typeid?"selected":""%> value="<%=item.typeid%>"><%=item.typename%></option>
							<%})%>
						</script>
					</select>
				</form>
			 </div>
			<div class="table" ajat="item/index?<%=query._%>#domid=table&tempid=table-t" id="table">
			<script type="text/template" id="table-t">
			<table>
				<thead>
					<tr>
						<th>序号</th>
						<th>项目名称</th>
						<th>项目分类</th>
						<th>规格</th>
						<th>原价</th>
						<th>臭美价</th>
						<th>集团价</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<%data=data.data%>
					<%data.forEach(function(item,i){%>
					<%
						var index=i+1;
						if(query.sort_type=="DESC"||query.sort_type===undefined){
							index=data.length-i;
						}
					%>
					 <tr>
						<td><%=index%><input type="hidden" name="itemid" value="<%=item.itemid%>" /></td>
						<td><%=item.itemname%></td>
						<td><%=item.typename%></td>
						<td><%=item.norms_cat_id==1?"有规格":"无规格"%></td>
						<td><%=item.minPriceOri%></td>
						<td><%=item.minPrice%></td>
						<td><%=item.minPriceGroup%></td>
						<td>
							<%if(i!=0){%>
							<form action="item/sort" data-role="normal" _onsuccess="parent.lib.popup.result({define:function(){location.reload()}})">
								<button class="link" type="button" data-slug="salon.save" type="button" data-goto="up" >上移</button>
							</form>
							<span class="space"></span>
							<%}%>
							<%if(i!=data.length-1){%>
							<form action="item/sort" data-role="normal" _onsuccess="parent.lib.popup.result({define:function(){location.reload()}})">
								<button class="link"  type="button" data-slug="salon.save" type="button" data-goto="down">下移</button>
							</form>
							<%}%>
						</td>
					</tr> 
					<%})%>
				</tbody>
			</table>
			</script>
		</div>
	</div>
	<script type="text/javascript">
		$('#type').on('change',function(){
			$(this).closest('form').submit();
		});
		$('#table').on('click','.link',function(){
			var $this=$(this);
			if($this.data('goto')=='up'){
				$this.closest('tr').after($this.closest('tr').prev());
			}
			if($this.data('goto')=='down'){
				$this.closest('tr').before($this.closest('tr').next());
			}
			var form=$this.parent();
			form[0]._getFormData=function(){
				var sort=[];
				var input=$('input[name="itemid"]');
				input.each(function(i){
					var no=i+1;
					if(lib.query.sort_type!="ASC"){
						no=input.length-i;
					}
					sort.push({itemid:this.value,sort_in_type:no});
				});
				return {sort:sort};
			}
			form.submit();
		})
	</script>
  </body>
</html>