<!DOCTYPE html>
<html lang="zh-CN">
    <head>
      <meta charset="utf-8">
      <title>臭美管理后台</title>
      <script type="text/javascript" src="/js/include.js"></script>
      <link rel="stylesheet" href="income.css" />
    </head>
    <body>
        <div class="breadcrumb">
            <a>收入管理</a>
            <span>&gt;</span><a href="index.html">新增反佣单</a>
            <div class="flex-box">
                <div class="flex-item">
                    <h4>新增反佣单</h4>
                </div>
            </div>
        </div>
        <div class="wrapper">
            <form novalidate="" action="rebate/create" method="post" class="form-vertical" data-role="form">
                <div class="detail-operation">
                    <button type="button" class="btn" onclick="history.back()">取消</button>
                    <span class="space"></span>
                    <button class="btn-primary">提交</button>
                </div>    

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>店铺名称：</label>
                    <div class="control complete">
                        <input type="hidden" name="salon_id" id="salonid"/>
                        <input type="hidden" id="salonsn"/>
                        <input id="search" type="text" ajat-complete="salonAccount/getSalonName?salonname=${value}#domid=complete-position&tempid=complete-position-t" autocomplete="off" required>
                        <div class="complete-position" id="complete-position" style="width:20%;min-width:250px;">
                            <script type="text/template" id="complete-position-t">
                            <%if(data.length>0){%>
                            <ul>
                                <%data.forEach(function(item){%>
                                <li class="complete-item <%if(protocol.query.salonname==item.salonname){%>active<%}%>" data-salonid="<%=item.salonid%>" data-merchantid="<%=item.merchantId%>" data-merchantname="<%=item.name%>" ><%=item.salonname%></li>
                                <%})%>
                            </ul>
                            <%}else{%>
                            <div style="padding:5px 10px;">没有查找到店铺</div>
                            <%}%>
                            </script>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>所属商户：</label>
                    <div class="control">
                        <input type="text" id="merchantname"  disabled>
                        <input type="hidden"  id="merchantId" />
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>结算起始日：</label>
                    <div class="control">
                        <input type="date" id="start_at" name="start_at" required>
                    </div>
                </div> 

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>结算截止日：</label>
                    <div class="control">
                        <input type="date" id="end_at" name="end_at" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>金额：</label>
                    <div class="control">
                        <input type="text" id="amount" name="amount" required>
                    </div>
                </div>  

                <div class="control-group">
                    <label class="control-label" for=""></label>
                    <button type="button" class="btn" id="perview_btn">预览</button>
                    <button class="btn-primary mr-20">提交</button>
                </div>
            </form>       
        </div>
        <script>

            var type = lib.query.type;

            if(type == "edit"){
                var obj = JSON.parse(sessionStorage.getItem('edit-rebate-data'));
                $("#salonid").val(obj.salon.salon_id);
                $("#salonsn").val(obj.salon.sn);
                $("#search").val(obj.salon.salonname);
                $("#start_at").val(new Date(obj.start_at).format("yyyy-MM-dd"));
                $("#end_at").val(new Date(obj.end_at).format("yyyy-MM-dd"));
                $("#amount").val(obj.amount);
                // $('#merchantId').val(obj.salon.merchantId);
                // $("#merchantname").val(obj.salon.name);
            }

            $('#search').on('autoinput',function(e,data){
                if(data){
                    $('#salonid').val(data.salonid);
                    $('#salonsn').val(data.salonsn)
                    $('#merchantId').val(data.merchantid);
                    $('#merchantname').val(data.merchantname);
                }
            });

            $("#perview_btn").on('click',function(){
                var data = JSON.parse(sessionStorage.getItem('edit-rebate-data'));
                var obj = {salon:{}};
                obj.salon.salon_id  = $("#salonid").val();
                obj.salon.sn        = $("#salonsn").val();
                obj.salon.salonname = $("#search").val();
                obj.salon.merchantname = $("#merchantname").val();
                obj.start_at = $("#start_at").val(); 
                obj.end_at = $("#end_at").val();
                obj.amount = $("#amount").val(); 
                sessionStorage.setItem("income-rebate-perview",JSON.stringify($.extend(data,obj)));
                window.open("detail.html?type=perview");
            });
        </script>
    </body>
</html>