<!DOCTYPE html>
<html lang="zh-CN">
  <head>
      <meta charset="utf-8">
	  <title>臭美管理后台</title>
	  <script type="text/javascript" src="/js/include.js"></script>
  </head>
  <body>
		<div class="breadcrumb">
			<a>系统配置</a><span>&gt;</span><a>反欺诈</a><span>&gt;</span><a>黑名单-<span class='name'></span></a><span>&gt;</span><a>手动添加黑名单-<span class='name'></span></a>
			<div class="flex-box">
				<div class="flex-item">
					<h4>手动添加黑名单-<span class='name'></span></h4>
				</div>
			</div>
		</div>
        <style>
         .clear-color{
             background-color: #fff !important;
             border-color: #fff !important;
         }
        </style>
		<div class="wrapper">
        <div class="fr">
        <button class="btn  btn-primary" id="uploadFile">选取文件</button>
        <input type="hidden" name="keywordType" id="type">
        </div>

        <p class="small">注：通过导入xls. 文件以手动添加黑名单，格式需包含 序号、<span class='name'></span>、备注（进入黑名单原因等）</p>

        <span>预览</span>
		<div class="table" id="table">
			<script type="text/template" id="table-t">
                <table>
                <thead>
                <tr>
                <th>序号</th>
                <th><span class='name'></span></th>
                <th>备注</th>
                <th class='clear-color'></th>
                </tr>
                </thead>
                <tbody>
                <%data.data && data.data.forEach(function(item,index){%>
                  <tr>
                    <td><%=index+1%></td>
                    <td><%=item.mobilephone%></td>
                    <td><%=item.username%></td>
                    <td class='clear-color assertive'><%=item.device_uuid%></td>
                  </tr>
                <%})%>
                </tbody>
                </table>
                <div class="pager">
                </div>
			</script>
		</div>
        <a class="btn" onclick="history.back()" type="button">返回</a>
        <form action="blacklist/submit" data-role="normal" onsuccess="history.back()">
            <input type="hidden" name="redisKey" id="redisKey" value="">
            <button class="btn btn-primary">提交</button>
        </form>
	</div>
    <script>
        var configInfo = [
            {
                name:'手机号',
                uploadUrl:cfg.url.host+'blacklist/upload?keywordType=0&token='+window.localStorage.getItem('token'),
                submitUrl:'',
                type:'mobilephone'
            },
            {
                name:'设备号',
                uploadUrl:cfg.url.host+'blacklist/upload?keywordType=1&token='+window.localStorage.getItem('token'),
                submitUrl:'',
                type:'device_uuid'
            },
            {
                name:'微信OpenId',
                uploadUrl:cfg.url.host+'blacklist/upload?keywordType=2&token='+window.localStorage.getItem('token'),
                submitUrl:'',
                type:'openid'
            }
        ];

        var type = lib.tools.parseQuery(window.location).item;
        var pageConfig = configInfo[type];
        var initPage = function(){
            $('.name').html(pageConfig.name);
            $('#type').val(type);
        }();
        $('#table').on('_ready',function(){
            $('.name').html(pageConfig.name);
        })
        lib.puploader.create({
                    browse_button: 'uploadFile',
                    auto_start:true,
                    file_data_name:"blacklist",
                    domain:pageConfig.uploadUrl,
                    filters: {
                        mime_types : [
                            { title : "Excel file", extensions : "xls,xlsx,csv" },
                        ]
                    }
        },function(uploader){
            uploader.bind('FileUploadedSuccess',function(up,file,re){
                renderList(re.data);
                $('#redisKey').val(re.data.redisKey);
            })
        });

        var renderList = function(data){
            var newAjat = lib.ajat('#domid=table&tempid=table-t').render(data);
        }
    </script>
  </body>
</html>
