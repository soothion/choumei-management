<!DOCTYPE html>
<html lang="zh-CN">
    <head>
      <meta charset="utf-8">
      <title>臭美管理后台</title>
      <script type="text/javascript" src="../../js/include.js"></script>
      <link rel="stylesheet" href="shop.css" />    
    </head>

    <body>
        <div class="breadcrumb">
            <a>店铺管理</a>
            <span>&gt;</span>
            <a href="index.html">店铺列表</a>
            <span>&gt;</span><%=query.type=="add" ? "新增店铺" : "编辑店铺"%>
			<div class="flex-box">
				<div class="flex-item">
					<h4><%=query.type=="add" ? "新增店铺" : "编辑店铺"%></h4>
				</div>
			</div>
			<hr />
        </div>
        
        <div class="wrapper">
          
            <form novalidate="" class="form-vertical" data-role="form" id="form">
            <script type="text/template" id="form-t">  
				<div class="detail-operation">
					<button type="button" class="btn" onclick="history.back()">取消</button>
					<span class="space"></span>
					<button class="btn-primary">提交</button>
				</div>
				<ul class="nav-step flex-box">
					<li class="flex-item active"><span class="arrow">1.店铺基本信息</span></li>
					<li class="flex-item"><span>2.银行账号信息</span></li>
					<li class="flex-item"><span>3.准入评估信息</span></li>
					<li class="flex-item"><span>4.附件上传</span></li>
				</ul>
                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>店铺编号：</label>
                    <div class="control">
                        <input type="text" name="sn" value="<%=data.sn%>" placeholder="店铺编号" maxlength="10" required unique="salon/checkSalonSn?sn=${value}" data-value="<%=data.sn||""%>" uniquemsg="此店铺编号已经存在">
                    </div>
                </div> 
                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>店铺名称：</label>
                    <div class="control">
                        <input type="text" name="salonname" value="<%=data.salonname%>" placeholder="店铺名称" maxlength="16" required>
                    </div>
                </div> 

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>所属商户：</label>
                    <div class="control">
                        <input type="text" name="name" value="<%=data.name%>" placeholder="所属商户" disabled>
                        <input type="hidden" name="merchantId" value="<%=data.merchantId%>">
                        <input type="hidden" name="name" value="<%=data.name%>">
                    </div>
                </div>

                <div class="control-group" style="margin-bottom:0">
                    <label class="control-label" for=""><span class="red">*</span>店铺地址：</label>
						<select id="province" name="provinceId" class="select min-width" required ajat-one="true" 
						ajat="salonList/getProvinces?type=1#domid=province&tempid=province_t&provinceId=<%=data.provinceId%>" ajat-change="salonList/getProvinces?type=2&areaId=${value}#domid=city&tempid=city_t&citiesId=<%=data.citiesId%>">
						</select>
						<select id="city" name="citiesId" class="select min-width" required ajat-one="true" 
						ajat="<%if(data.provinceId){%>salonList/getProvinces?type=2&areaId=<%=data.provinceId%><%}%>#domid=city&tempid=city_t&citiesId=<%=data.citiesId%>"
						ajat-change="salonList/getProvinces?type=3&areaId=${value}#domid=area&tempid=area_t&district=<%=data.district%>">
						</select>
                        
						<select id="area" name="district" class="select min-width" style="margin-right:10px" 
                        required ajat-one="true"
						ajat="<%if(data.citiesId){%>salonList/getProvinces?type=3&areaId=<%=data.citiesId%><%}%>#domid=area&tempid=area_t&district=<%=data.district%>"
						ajat-change="salonList/getProvinces?type=4&areaId=${value}#domid=zone&tempid=zone_t&zone=<%=data.zone%>"
						>
						</select>
						<span class="control-help" style="display:none;"></span>
						
                </div>

                <div class="control-group" style="margin:0">
                    <label class="control-label" for=""></label>
                    <textarea class="textarea" name="addr" id="address" placeholder="详细街道信息" 
                    maxlength="50" required ><%=data.addr%></textarea>
                </div>                  

                <div class="control-group" style="margin:0">
                    <label class="control-label" for=""></label>
                    <div class="textarea-bar">
                        <span class="area-coor">地理坐标：</span>
                        <span  id="coorMarker"><%=data.addrlati && data.addrlong ? '已标记' : '未标记'%></span>                         
                        <button class="btn area-btn" id="addCoordinate" type="button">
                            <i class="fa fa-map-marker"></i> 
                            <span>添加坐标</span>
                        </button>
                    </div>
                    <input id="coorMarkerInput" name="lngLat" type='hidden' required requiredmsg="未标记"
                    value="<%=data.addrlati && data.addrlong ? data.addrlati+','+data.addrlong : ''%>">
                    <span class="control-help"  style="display:none;"></span>
                </div>    

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>所属商圈：</label>

					<div class="control control-circle" id="zone" ajat="<%if(data.district){%>salonList/getProvinces?type=4&areaId=<%=data.district%><%}%>#domid=zone&tempid=zone_t&zone=<%=data.zone%>">

					</div>
                </div> 

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>店铺类型：</label>
                    <input type="radio" class="radio" id="radio1" name="shopType" value="1"
                    <%=!data.shopType||data.shopType==1 ? "checked" : "" %>>
                    <label for="radio1">预付款店</label>

                    <input type="radio" class="radio" id="radio2" name="shopType" value="2" 
                    <%=data.shopType==2 ? "checked" : "" %>>
                    <label for="radio2">投资店</label>

                    <input type="radio" class="radio" id="radio3" name="shopType" value="3"
                    <%=data.shopType==3 ? "checked" : "" %>>
                    <label for="radio3">金字塔店</label>

                    <span class="control-help" style="display:none;"></span>
                </div> 

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>合同编号：</label>
                    <div class="control">
                        <input type="text" name="bargainno" value="<%=data.bargainno%>" placeholder="合同编号" maxlength="16" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>合同日期：</label>
                    <div class="control">
                        <%
                        if(data.contractTime==0){
                            data.contractTime = "";
                        }else if(!isNaN(data.contractTime)){
                            data.contractTime = lib.getDate(data.contractTime);
                        }
                        %>                        
                        <input type="date" name="contractTime" value="<%=data.contractTime%>" required 
                        min="1950-01-01" max="2030-01-01">
                    </div>
                </div>  

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>合同限期：</label>
                    <%
                     var arr = [];
                     if(data.contractPeriod){
                        arr = data.contractPeriod.split("_");
                     }else{
                        arr[0] = 3;
                        arr[1] = 0;
                     }
                    %>
                    <select class="select min-width" name="contractLimitY">
                        <option value="0" <%=arr[0]==0 ? 'selected' : ''%> >0年</option>
                        <option value="1" <%=arr[0]==1 ? 'selected' : ''%> >1年</option>
                        <option value="2" <%=arr[0]==2 ? 'selected' : ''%> >2年</option>
                        <option value="3" <%=arr[0]==3 ? 'selected' : ''%> >3年</option>
                        <option value="4" <%=arr[0]==4 ? 'selected' : ''%> >4年</option>
                        <option value="5" <%=arr[0]==5 ? 'selected' : ''%> >5年</option>
                        <option value="6" <%=arr[0]==6 ? 'selected' : ''%> >6年</option>
                        <option value="7" <%=arr[0]==7 ? 'selected' : ''%> >7年</option>
                        <option value="8" <%=arr[0]==8 ? 'selected' : ''%> >8年</option>
                        <option value="9" <%=arr[0]==9 ? 'selected' : ''%> >9年</option>
                        <option value="10"<%=arr[0]==10 ? 'selected' : ''%>>10年</option>
                    </select>

                    <select class="select min-width" name="contractLimitM">
                        <option value="0" <%=arr[1]==0 ? 'selected' : ''%>>0月</option>
                        <option value="1" <%=arr[1]==1 ? 'selected' : ''%>>1月</option>
                        <option value="2" <%=arr[1]==2 ? 'selected' : ''%>>2月</option>
                        <option value="3" <%=arr[1]==3 ? 'selected' : ''%>>3月</option>
                        <option value="4" <%=arr[1]==4 ? 'selected' : ''%>>4月</option>
                        <option value="5" <%=arr[1]==5 ? 'selected' : ''%>>5月</option>
                        <option value="6" <%=arr[1]==6 ? 'selected' : ''%>>6月</option>
                        <option value="7" <%=arr[1]==7 ? 'selected' : ''%>>7月</option>
                        <option value="8" <%=arr[1]==8 ? 'selected' : ''%>>8月</option>
                        <option value="9" <%=arr[1]==9 ? 'selected' : ''%>>9月</option>
                        <option value="10" <%=arr[1]==10 ? 'selected' : ''%>>10月</option>
                        <option value="11" <%=arr[1]==11 ? 'selected' : ''%>>11月</option>
                    </select>
                </div> 


                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>联系人：</label>
                    <div class="control">
                        <input type="text" name="bcontacts" value="<%=data.bcontacts%>" placeholder="联系人" maxlength="8" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>联系电话：</label>
                    <div class="control">
						 <input type="text" name="phone" value="<%=data.phone%>" placeholder="请输入11位有效手机号" 
                         maxlength="11" pattern="mobile" patternmsg="请输入11位有效手机号码" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>店铺电话：</label>
                    <div class="control">                       
                        <input type="text" name="tel" value="<%=data.tel%>" placeholder="请输入7-12位有效店铺电话" 
                        maxlength="12" pattern="phone" patternmsg="请输入7-12位有效店铺电话" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>法人代表：</label>
                    <div class="control">
                        <input type="text" name="corporateName" value="<%=data.corporateName%>" 
                        placeholder="法人代表" maxlength="8" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>法人电话：</label>
                    <div class="control">
                        <input type="text" name="corporateTel" value="<%=data.corporateTel%>" placeholder="请输入11位有效手机号" 
                        maxlength="11" pattern="mobile" patternmsg="请输入11位有效手机号" required>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""><span class="red">*</span>业务代表：</label>
                    <select class="select defalut-width" name="businessId" id="business" required 
                    ajat="salonList/getBussesName#domid=business&tempid=business_t&businessId=<%=data.businessId%>">

                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for=""></label>
                    <button class="btn" type="button" id="preview-btn" style="margin-right:20px">预览</button>
                    <button class="btn-primary">下一步</button>
                </div>
            </script>
            </form>       
        </div>

		<div class="map-container">
			<style type="text/css">
				.map-container{
					position:fixed;left:0;top:0;width:100%;height:100%;display:none;
					z-index:1000;
				}
				.map-toolbar{
					position:absolute;left:0;top:0;width:100%;z-index:100;background:rgba(255,255,255,0.7);
					box-shadow:0px 0px 5px rgba(0,0,0,0.1);
				}
				.map-toolbar>div{
					padding:10px;
				}
				.map-toolbar input{
					width:250px;
				}
				.map-inner{
					position:absolute;left:0;top:0;width:100%;height:100%;
				}
				.map-marker-address{
					font-size:16px;
					line-height:32px;
				}
				.BMap_stdMpCtrl{
					top:65px!important;
				}
			</style>
			<div class="map-toolbar">
				<div class="flex-box">
					<div class="flex-item map-marker-address">标记位置：<span id="address-text">未标记</span></div>
					<div class="tc" >
						<input  type="text" id="map-search" placeholder='请输入关键字' />
					</div>
					<div class="flex-item" style="text-align:right">
						<button class="btn">返回</button>
						<span class="space"></span>
						<button class="btn-primary">确定</button>
					</div>
				</div>
			</div>
			<div class="map-inner"id="map-wrapper"></div>
		</div>
        <script type="text/template" id="province_t">
            <option value="">省份</option>
            <%data.forEach&&data.forEach(function(item){%>
                <option <%=item.pid==protocol.custom.provinceId?"selected":""%> value="<%=item.pid%>"><%=item.pname%></option>
            <%})%>
        </script>

        <script type="text/template" id="city_t">
            <option value="">城市</option>
            <%data.forEach&&data.forEach(function(item){%>
                <option <%=item.iid==protocol.custom.citiesId?"selected":""%> value="<%=item.iid%>"><%=item.iname%></option>
            <%})%>
        </script>

        <script type="text/template" id="area_t">
            <option value="">地区</option>
            <%data.forEach&&data.forEach(function(item){%>
                <option <%=item.tid==protocol.custom.district?"selected":""%> value="<%=item.tid%>"><%=item.tname%></option>
            <%})%>
        </script>

        <script type="text/template" id="business_t">
            <option value="">请选择</option>
            <%data.forEach&&data.forEach(function(item){%>
                <option <%=item.id == protocol.custom.businessId ? "selected":""%> value="<%=item.id%>">
                <%=item.businessName%></option>
            <%})%>
        </script>

		<script type="text/template" id="zone_t">
			<%data.forEach&&data.forEach(function(item){%>
			<input type="radio" class="label" id="areaRadio<%=item.areaid%>" <%=item.areaid==protocol.custom.zone?"checked":""%>  name="zone" value="<%=item.areaid%>" required>
			<label for="areaRadio<%=item.areaid%>"><%=item.areaname%></label>
			<%})%>
			<%if(data.length>0){%>
				<div class="control-help" style="display:none;"></div>
			<%}else{%>
				<input type="hidden" name="zone" required requiredmsg="请选择有商圈的地区"/>
			<%}%>
		</script>
       
        <script src="add.js"></script>

        <script src="http://api.map.baidu.com/api?v=2.0&ak=F360d7e9ea3c3ecb5b9b9f2b530be8f4&callback=renderMap()">
        </script>
        
    </body>
</html>