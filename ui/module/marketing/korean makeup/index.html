<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <title>臭美管理后台</title>
        <script type="text/javascript" src="/js/include.js"></script>
        <style type="text/css">
            .tc{
                text-align: center !important;
            }
        </style>
    </head>
    <body>
        <div class="breadcrumb">
            <a>营销中心</a><span>&gt;</span><a href="index.html">定妆赠送活动</a>
            <div class="flex-box">
                <div class="flex-item">
                    <h4> 定妆赠送活动 </h4>
                </div>
                <div class="flex-item">
                    <a href="add_act.html" class="btn-primary fr" data-slug="coupon.add">
                        <i class="fa fa-plus"></i> 新增兑换活动
                    </a>
                </div>
            </div>
        </div>
        <div class="wrapper">
            <form data-role="hash">
              <div class='input-group'>
                <input type="text" name="keyword" value="" placeholder="活动名称">
              </div>
              <span class="space"></span>
               <div class="input-group">
                 <select name="department" ajat-one="true" id="department" ajat="list/department#domid=department&amp;tempid=department-t">
                     <script type="text/template" id="department-t">
                         <option value="">申请部门</option>
                         <%data.forEach(function(item){%>
                             <option value="<%=item.id%>"><%=item.title%></option>
                         <%})%>
                     </script>
                 </select>
                </div>

                <span class="space"></span>
                <span>活动时间：</span>
                <span class="date-group">
                    <input type="date" data-role="start" name="startTime" placeholder="YYYY-MM-DD"/>
                    至
                    <input type="date" data-role="end" name="endTime" placeholder="YYYY-MM-DD"/>
                </span>
                <button class="btn" type="submit">查询</button>
            </form>
           <div class="table" ajat="coupon/list?<%=query._%>#domid=table&tempid=table-t" id="table">
            <script type="text/template" id="table-t">
                <table>
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>活动名称</th>
                            <th>赠送项目</th>
                            <th>券总数</th>
                            <th>已使用数</th>
                            <th>未使用数</th>
                            <th>活动起始日</th>
                            <th>活动截止日</th>
                            <th>有效期</th>
                            <th>申请部门</th>
                            <th>创建日期</th>
                            <th>活动状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                <tbody>
                <%var data=data.data%>
                <%data.forEach(function(item,index){%>
                 <tr>
                  <td><%=index+1%></td>
                  <td><%=item.vcTitle%></td>
                  <td><%=item.vcSn%></td>
                  <td><%=item.totalNum%></td>
                  <td><%=item.useNum%></td>
                  <td><%=item.allNum%></td>
                  <td><%=item.addTime%></td>
                  <td><%=item.actTime%></td>
                  <td><%=item.department%></td>
                  <td><%=status[item.status]%></td>
                  <td class="tc">
                    <a class="link" data-slug="coupon.actView" href="detail_act.html#id=<%=item.vcId%>">查看</a>
                  </td>
                  </tr>
                  <%})%>
                </tbody>
            </table>
             <div class="pager"> </div>
            </script>
            <script type="text/javascript">

               var clearTmpData  = function(){
                   window.localStorage.removeItem('couponTmpData');
               }

               var confirmBox = function(options){
                    lib.popup.confirm({
                        text:options.text,
                        define: function(){
                            lib.ajax({
                                url : options.url+options.id
                            }).done(function(data, status, xhr){
                                if(data.result == 1){
                                    parent.lib.popup.result({
                                        text:options.resultText,
                                        define:function(){
                                            location.reload();
                                        }
                                    });
                                }
                            });
                        }
                    });
               }
               var confirmBoxConfig = {
                    'offline':{
                        text:'确定将该活动下线吗？',
                        url:'coupon/offlineConf/',
                        resultText:'活动下线成功'
                    },
                    'online':{
                        text:'确定将该活动上线吗？',
                        url:'coupon/upConf/',
                        resultText:'活动正在上线中...'
                    },
                    'close':{
                        text:'确定将该活动关闭吗？',
                        url:'coupon/closeConf/',
                        resultText:'活动关闭成功'
                    }
               }
               $('body').on('click','#offline',function(){
                    var id = $(this).attr('data-id');
                    confirmBoxConfig['offline'].id = id;
                    confirmBox(confirmBoxConfig['offline']);

               }).on('click','#online',function(){
                    var id = $(this).attr('data-id');
                    confirmBoxConfig['online'].id = id;
                    confirmBox(confirmBoxConfig['online']);

               }).on('click','#close',function(){
                    var id = $(this).attr('data-id');
                    confirmBoxConfig['close'].id = id;
                    confirmBox(confirmBoxConfig['close']);
               }).on('click','#add_new',function(){
                    clearTmpData();
                    window.location.href="addBase.html";
               });
            </script>
        </div>
            </div>
    </body>
</html>
