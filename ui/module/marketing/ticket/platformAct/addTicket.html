<!DOCTYPE html>
<html lang="zh-CN">
    <head>
      <meta charset="utf-8">
      <title>臭美管理后台</title>
      <script type="text/javascript" src="/js/include.js"></script>
      <style>
        .table tbody tr:hover{
            background:none;
        }
        input[type=date]{
            width:150px;
        }
      </style> 
    </head>
    <body>
        <div class="breadcrumb">
            <a>券活动管理</a>
            <span>&gt;</span>
            <a href="index.html">平台活动</a>
            <span>&gt;</span>新增活动
            <div class="flex-box">
                <div class="flex-item">
                    <h4>新增活动</h4>
                </div>
            </div>
            <hr />
        </div>

        <div class="wrapper">
            <form class="form-vertical" data-role="form" id="form">
            <script type="text/template" id="form-t">
                <div class="detail-operation">
                    <button type="button" class="btn btn-cancel">取消</button>
                    <span class="space"></span>
                    <button class="btn-primary">提交</button>
                </div>        

                <ul class="nav-step flex-box">
                    <li class="flex-item">
                        <a href="addBase.html">
                            <i class="fa fa-check-circle"></i>
                            <span>1.活动基本信息</span>
                        </a>
                    </li>

                    <li class="flex-item"> 
                        <a href="addUser.html">
                            <i class="fa fa-check-circle"></i>
                            <span>2.选择用户</span>
                        </a>
                    </li>

                    <li class="flex-item active">
                        <span class="arrow">3.定义现金券</span>
                    </li>
                </ul>
            
                <table class="table" width="100%">
                <thead>
                <tr>
                <th>现金券设定</th>
                </tr>                              
                </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div style="margin:15px">
                                    <span style="display: inline-block;width:130px">券金额:</span>
                                    <input type="text" class="nonzero" name="money" required maxlength="3" value="<%=data.money||1%>" <%=query.type=='add' ? '' : 'readOnly'%>/>
                                    <strong>元&nbsp;&nbsp;&nbsp;</strong>
                                    <span style="color: #ddd;">（不可修改，可填写1~999)</span>
                                    <span class="control-help" style="display:none;"></span>
                                </div>

                                <div style="margin:15px">
                                    <span style="display: inline-block;width:130px">满额使用(单个项目)</span>
                                    <input type="text" name="singleEnoughMoney" value="<%=data.singleEnoughMoney ||0%>"/>
                                    <strong>元&nbsp;&nbsp;&nbsp;以上可用</strong>
                                    <span style="color: #ddd;">(大于或等于该数值可使用，0为不限制，可填写0~999) </span>
                                    <span class="control-help" style="display:none;"></span>
                                </div>

                                <hr />

                                <div style="margin:15px">
                                    <span style="display: inline-block;width:130px">券总数:</span>

                                    <label class="radio">
                                        <input type="radio" class="ticketNum" name="checkTotalNumber" value="0" checked>
                                        <span>不限</span>
                                        <input type="hidden" class="ticketNumHidden" name="totalNumber" value="0">
                                    </label>
                                    

                                    <span style="margin-right: 15px;border-left:1px solid #ddd"></span>

                                    <label class="radio">
                                        <input type="radio" class="ticketNum" name="checkTotalNumber" value="1">
                                        <span>自定义</span>
                                    </label>

                                    <input type="text" class="nonzero" id="ticketNumInput" name="totalNumber" value="1" required disabled="disabled" pattern='number' <%=query.type=='add' ? '' : 'readOnly'%>/>
                                    <strong>张&nbsp;&nbsp;&nbsp;</strong>
                                    <span style="color: #ddd;">(不可修改，可填写1~999）</span>
                                    <span class="control-help" style="display:none;"></span>
                                </div> 

                                <hr />  

                                <div style="margin:15px">
                                    <span style="display: inline-block;width:130px">领券上限：</span>
                                    <input type="text" name="getSingleLimit" value="<%=data.getSingleLimit%>" maxlength="6" required pattern='number'/>
                                    <strong>张&nbsp;&nbsp;&nbsp;</strong>
                                    <span style="color: #ddd;">(每人本活动领券总上限，每次活动只可获取一张)</span>
                                    <span class="control-help" style="display:none;"></span>
                                </div>                                                                 
                            </td>
                        </tr>                                 
                    </tbody>
                </table>


                <table class="table" width="100%">
                    <thead>
                        <tr>
                        <th colspan="2">时间限制</th>
                        </tr>                              
                        </thead>

                        <tbody>
                            <tr>
                                <td>活动（获取）时间</td>
                                <td>
                                    <%
                                    if(data.getTimeStart){
                                        data.getTimeStart = new Date(data.getTimeStart).format('yyyy-MM-dd');
                                    }

                                    if(data.getTimeEnd){
                                        data.getTimeEnd = new Date(data.getTimeEnd).format('yyyy-MM-dd');
                                    }
                                    %>
                                    <input type="date" name="getTimeStart" value="<%=data.getTimeStart%>" required/>
                                    <span>至</span>
                                    <input type="date" name="getTimeEnd" value="<%=data.getTimeEnd%>" required/>
                                    <span class="control-help" style="display:none;"></span>
                                </td>
                            </tr>    

                            <tr>
                                <td>券有效时间</td>
                                <td>
                                    <div style="margin:15px">
                                        <label class="radio">
                                            <input type="radio" class="avaDateRadio" name="avaDate" value="1" 
                                            <%=(!data.addActLimitStartTime && !data.fewDay) || data.addActLimitStartTime ? 'checked' :'' %>>
                                            <span>指定有效期</span>
                                        </label> 
                                        <%
                                            if(data.addActLimitStartTime){
                                                data.addActLimitStartTime = new Date(data.addActLimitStartTime).format('yyyy-MM-dd');
                                            }

                                            if(data.addActLimitEndTime){
                                                data.addActLimitEndTime = new Date(data.addActLimitEndTime).format('yyyy-MM-dd');
                                            }
                                        %>
                                        <input type="date" id="avaDateStart" name="addActLimitStartTime" 
                                        value="<%=data.addActLimitStartTime%>" <%=(!data.addActLimitStartTime && !data.fewDay) || data.addActLimitStartTime ? 'checked' :'disabled' %> required/>
                                        <span>至</span>
                                        <input type="date" id="avaDateEnd" name="addActLimitEndTime" 
                                        value="<%=data.addActLimitEndTime%>" <%=(!data.addActLimitStartTime && !data.fewDay) || data.addActLimitStartTime ? 'checked' :'disabled' %> required/>
                                        <span class="control-help" style="display:none;"></span>        
                                    </div>

                                    <hr />

                                    <div style="margin:15px">
                                        <label class="radio">
                                            <input type="radio" class="avaDateRadio" name="avaDate" value="2" 
                                            <%=data.fewDay ? 'checked' :'' %>>
                                            <span>自定义有效期区间</span>
                                        </label>
                                        <input type="text" id="avaDay" name="fewDay" value="<%=data.fewDay%>" required
                                        <%=data.fewDay ? '' :'disabled' %>  pattern='number'/>
                                        <span style="color: #ddd;">天内有效（获取现金券后）</span>
                                        <span class="control-help" style="display:none;"></span> 
                                    </div>    
                                </td>
                            </tr>                               
                    </tbody>
                </table>

                <table class="table" width="100%">
                <thead>
                    <tr>
                    <th>使用限制</th>
                    </tr>                              
                </thead>

                <tbody>
                    <tr>
                        <td>
                            <div style="margin:10px"><strong>指定项目类别支付可用</strong></div>
                            <div id="itemType" ajat-one="true" ajat="platform/getItemType#domid=itemType&tempid=itemType-t&limitItemTypes=<%=data.limitItemTypes%>">

                            </div>
                        </td>
                    </tr>

                    <tr>
                    <td>
                    <label class="checkbox">
                    <input type="checkbox" name="useLimitTypes" value="2" <%=data.useLimitTypes ? 'checked':''%>>
                    <span>限制首单使用</span>
                    </label>                                      
                    </td>                                
                    </tr>                                   
                </tbody>
                </table>

                <table class="table" width="100%">
                <thead>
                    <tr>
                        <th colspan="2">
                            <label class="checkbox">
                                <input type="checkbox" id="smsControl" <%=data.sendSms ? 'checked' : ''%>>
                                <span>发送手机短信</span>
                            </label> 
                        </th>
                    </tr>                              
                </thead>

                <tbody>
                    <tr>
                    <td>手机短信内容</td>
                    <td><textarea name="sendSms" maxlength="500" id="smsTextArea"
                    placeholder="限制500个汉字的长度,[useMoney]:接收短信用户获取的现金券金额,[name]:活动名称,[overtime]:接收短信用户获取的现金券有效结束时间" style="width: 500px;" 
                    <%=data.sendSms ? '' : 'disabled'%>><%=data.sendSms%></textarea></td>
                    </tr>                                 
                </tbody>
                </table>                                                                                                                                               
                <div class="control-group">
                    <button class="btn" type="button" id="preview-btn" style="margin-right:20px">预览</button>
                    <button class="btn-primary">提交</button>
                </div>
                </script> 
            </form>                                                                 
        </div>

        <script type="text/template" id="itemType-t">
            <%
            var itemsObj = {};
            if(protocol.custom.limitItemTypes){
                var items = protocol.custom.limitItemTypes.split(",");
                items.forEach(function(item,i){
                    itemsObj[item] = true;
                });
            }
            %>        
            <%data.forEach&&data.forEach(function(item,i){%>
                <label class="checkbox">
                    <input type="checkbox" name="limitItemTypes" value="<%=item.typeid%>" 
                    <%=itemsObj[item.typeid] ? "checked":""%>>
                    <span><%=item.typename%></span>
                </label> 
            <%})%>
        </script>  

        <script src="addTicket.js"></script>                
    </body>
</html>